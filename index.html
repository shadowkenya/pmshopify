<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lipa na M-Pesa Secure Payment</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom font import (Inter is standard) */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc; /* Subtle light background */
        }
        /* Custom Swing Animation for the tick icon */
        @keyframes swing {
            0% { transform: rotate(0deg); }
            10% { transform: rotate(10deg); }
            30% { transform: rotate(-10deg); }
            50% { transform: rotate(10deg); }
            70% { transform: rotate(-10deg); }
            90% { transform: rotate(5deg); }
            100% { transform: rotate(0deg); }
        }
        .swing-animation {
            animation: swing 1s ease-in-out 5; /* Swing 5 times over 5 seconds */
            transform-origin: top center;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">

    <!-- Payment Container Card - Max width reduced from max-w-md to max-w-sm (384px) for compactness -->
    <div id="paymentCard" class="bg-white p-6 sm:p-8 rounded-xl shadow-2xl max-w-sm w-full border-t-8 border-green-600 transition-all duration-500">
        
        <!-- Secure Payment Header -->
        <div class="text-center mb-8">
            <h1 class="text-xl sm:text-2xl font-extrabold text-gray-800 mb-2">Lipa na M-Pesa</h1>
            <p class="text-lg font-semibold text-gray-600 flex items-center justify-center">
                <svg class="w-5 h-5 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path></svg>
                SECURE PAYMENT
            </p>
        </div>

        <!-- Success/Confirmation Message (Initially Hidden) -->
        <div id="successContainer" class="hidden text-center p-8 bg-green-50 rounded-xl transition-opacity duration-500">
            <svg id="successTick" class="w-24 h-24 mx-auto text-green-600 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <h2 class="text-4xl font-extrabold text-green-700 mb-2">Thank You!</h2>
            <p class="text-lg text-gray-600">Your payment has been successfully verified.</p>
        </div>

        <!-- Main Payment Content (Container to Hide/Show) -->
        <div id="paymentContent">
            <!-- Dynamic Amount to Pay Box -->
            <div id="amountBox" class="bg-emerald-600 text-white p-5 rounded-xl mb-8 text-center shadow-lg transition duration-300 hover:scale-[1.02] cursor-default active:scale-100">
                <p class="text-sm font-light uppercase opacity-90">Amount to Pay (Ksh)</p>
                <p id="paymentAmount" class="text-4xl font-black mt-1">20.00</p>
                <!-- Removed: "A subtle line to show data generation link (simulated)" -->
            </div>

            <!-- Payment Details Section -->
            <div class="space-y-4 mb-8">
                <!-- Paybill Number -->
                <div class="bg-green-50/70 p-4 rounded-lg border border-green-200 shadow-sm">
                    <p class="text-xs font-medium text-green-700 uppercase tracking-wider mb-1">Paybill Number</p>
                    <p class="text-2xl font-bold text-gray-900 tracking-wider">522522</p>
                </div>

                <!-- Account Number -->
                <div class="bg-green-50/70 p-4 rounded-lg border border-green-200 shadow-sm">
                    <p class="text-xs font-medium text-green-700 uppercase tracking-wider mb-1">Account Number</p>
                    <p class="text-2xl font-bold text-gray-900 tracking-wider">0758361830</p>
                </div>
            </div>

            <!-- Form for Transaction Code Submission -->
            <form id="mpesaForm">
                <div class="mb-6">
                    <label for="transactionCode" class="block text-sm font-medium text-gray-700 mb-2">M-Pesa Transaction Code</label>
                    <input 
                        type="text" 
                        id="transactionCode" 
                        name="transactionCode" 
                        placeholder="e.g., QWERT12345" 
                        required 
                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-green-500 focus:border-green-500 text-base shadow-sm"
                        maxlength="10"
                    >
                </div>

                <!-- Confirmation Checkbox -->
                <div class="flex items-center mb-6">
                    <input type="checkbox" id="confirmPayment" name="confirmPayment" required class="h-4 w-4 text-green-600 border-gray-300 rounded focus:ring-green-500">
                    <label for="confirmPayment" class="ml-3 block text-sm text-gray-700 select-none">
                        I confirm that I have sent the payment.
                    </label>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="bg-green-700 text-white py-3 rounded-lg hover:bg-green-800 transition duration-200 w-full font-bold text-lg shadow-md hover:shadow-lg">
                    Verify Transaction
                </button>
            </form>
        </div>

        <!-- Message Box for feedback (instead of alert) -->
        <div id="messageBox" class="mt-6 p-3 text-sm rounded-lg text-center hidden" role="alert"></div>

    </div>

    <script>
        // --- Dynamic Amount Generation Logic (Simulated) ---
        document.addEventListener('DOMContentLoaded', () => {
            const defaultAmount = 20.00; // Default amount in shillings
            const amountElement = document.getElementById('paymentAmount');
            const form = document.getElementById('mpesaForm');
            const messageBox = document.getElementById('messageBox');
            const paymentContent = document.getElementById('paymentContent');
            const successContainer = document.getElementById('successContainer');
            const successTick = document.getElementById('successTick');
            
            /**
             * Function to simulate fetching the amount from a backend/order.
             * @returns {number} The calculated amount.
             */
            function generatePaymentAmount() {
                console.log("Simulating dynamic amount generation...");
                return defaultAmount; 
            }

            // Set the initial amount display
            const initialAmount = generatePaymentAmount();
            amountElement.textContent = initialAmount.toFixed(2);


            // --- Form Submission Handler ---
            form.addEventListener('submit', (e) => {
                e.preventDefault();
                const codeInput = document.getElementById('transactionCode').value.trim();
                const amount = amountElement.textContent;

                // Simple validation check
                if (codeInput.length < 5) {
                    showMessage('Please enter a valid M-Pesa Transaction Code.', 'bg-red-100 text-red-700');
                    return;
                }

                // Simulate processing/verification
                showMessage(`Verifying Ksh ${amount} payment with code: ${codeInput}...`, 'bg-blue-100 text-blue-700');
                
                // Simulate an API call delay
                setTimeout(() => {
                    // 70% chance of success for demo
                    const isSuccessful = Math.random() > 0.3; 

                    if (isSuccessful) {
                        // 1. Hide the form content and message box
                        paymentContent.classList.add('hidden');
                        messageBox.classList.add('hidden');
                        
                        // 2. Show the success container and apply the swinging animation
                        successContainer.classList.remove('hidden');
                        successTick.classList.add('swing-animation');

                        // 3. Set a timeout for 5 seconds (5000ms)
                        setTimeout(() => {
                            // 4. Return to payment page (hide success, show content, reset form)
                            successContainer.classList.add('hidden');
                            successTick.classList.remove('swing-animation');
                            paymentContent.classList.remove('hidden');
                            form.reset(); 
                            showMessage('Payment complete. Ready for your next transaction.', 'bg-gray-100 text-gray-600');
                        }, 5000); 
                    } else {
                        showMessage('Verification failed. Please double-check the transaction code or wait a moment and try again.', 'bg-yellow-100 text-yellow-700');
                    }
                }, 2000); // 2 second delay for verification
            });

            /**
             * Displays a message in the custom message box.
             * @param {string} message The text to display.
             * @param {string} colorClasses Tailwind classes for background/text color.
             */
            function showMessage(message, colorClasses) {
                messageBox.textContent = message;
                messageBox.className = `mt-6 p-3 text-sm rounded-lg text-center ${colorClasses}`;
                messageBox.classList.remove('hidden');
            }
        });
    </script>

</body>
</html>